#### Git для ленивых: обзор консольной утилиты Lazygit

При работе с Git-репозиториями часто нужно выполнять множество одинаковых действий: фиксировать изменения, переключать ветки, синхронизировать репозитории. Всё это требует ввода соответствующих команд в терминале. Когда частота ввода повышается до утомительной, на помощь могут прийти различные GUI-инструменты. В статье расскажу об одном из них — [Lazygit](https://github.com/jesseduffield/lazygit), легковесном консольном клиенте для Git, который облегчает и упрощает работу с репозиториями.

#### Установка утилиты manjaro
```bash
sudo pacman -S lazygit
```

После установки запустить программу можно командой `lazygit`. Если в каталоге, в котором вы находитесь, уже инициализирован Git-репозиторий, он сразу же будет подхвачен, и можно начинать работать. Если репозитория нет,  программа спросит, нужно ли его там создать, предоставив на выбор два варианта: создать или отказаться (во втором случае программа не запустится).

#### Обзор интерфейса
Главный интерфейс программы разделен на несколько окон:

- _Files_ — здесь отображаются измененные файлы, если они есть.
    
- _Local branches_ — локальные ветки в склонированном репозитории.
    
- _Commits_ — все последние коммиты.
    
- _Diff_ — дифф изменений.
    
- _Command log_ — лог работы.

#### Работа с ветками
##### Переключение на удаленную ветку

В некоторых окнах можно переключиться на другой режим. Например, в окне с ветками можно просмотреть не только локальные, но и все ветки в удаленном репозитории, переключившись на режим _Remotes_. Для этого выбираем нужный репозиторий и нажимаем клавишу Enter.

После выбора репозитория появится список всех доступных удаленных веток. В окне _Diff_ при этом отобразится структура коммитов в соответствии с этими ветками.

Чтобы начать работать с веткой, на нее нужно переключиться — например, с помощью Space. При этом название локальной ветки, если необходимо, можно изменить.

После этого она станет доступна в разделе _Local Branches_.

##### Обновление веток
Если состояние текущей ветки актуально, она помечается зеленой галочкой.

Если локальная ветка «отстала» от мейнстрима, вместо галочки будет отображена стрелка, соответствующая состоянию отличий: 

- стрелка вниз — требуется скачать новые коммиты из удаленного репозитория;
    
- стрелка вверх — нужно отправить изменения.

Любую ветку можно обновить, выполнив `fetch` или `pull`. Программа позволяет сделать это с помощью горячих клавиш: переходим на нужную ветку и нажимаем клавишу **f** или **p** в зависимости от команды, которую нужно выполнить.

_Горячая клавиша может не сработать, если включена русская раскладка. Регистр также имеет значение — в этом конкретном случае нужно нажимать на маленькую f или p._

#### Создание новой ветки

Создать новую ветку можно с помощью клавиши **n**, выбрав ту ветку, от которой нужно ветвиться. Программа предложит ввести название новой ветки. После ввода будет создана новая, готовая к работе локальная ветка; она сразу появится в окне _Local Branches_.

_Обратите внимание, что программа автоматически ничего никуда не отправляет, и созданная ветка будет только на вашей машине. Для отправки ее в удаленный репозиторий нужно, как обычно, сделать_ `commit` _и_ `push`_._

#### Merge веток

Выполнить merge веток можно горячей клавишей **M**. Для этого сначала нужно переключиться на целевую ветку, затем выбрать ту, из которой будут вноситься изменения, и нажать **M**

### Внесение изменений, commit и push

#### Commit изменений

После того, как новая ветка создана, можно вносить изменения в код. По завершении в левом верхнем окне программы (_Files_) появится список изменившихся файлов, которые можно закоммитить в репозиторий.

В правом окне _Diff_ будут отображаться все изменения, внесенные в конкретный файл.

Чтобы зафиксировать изменения, нажимаем клавишу **a** (`git add`). Все измененные файлы позеленеют, то есть будут готовы к коммиту.

Чтобы закоммитить изменения, нажимаем клавишу **c** и в открывшемся окне вводим описание коммита.

Новый коммит появится в нижнем левом окне _Commits_.

#### Push в удаленный репозиторий

Для отправки зафиксированных изменений в удаленный репозиторий используется сочетание клавиш **Shift + P**.

Если вы делаете это впервые, программа спросит, с каким удаленным репозиторием предстоит работать и в какую ветку отправлять изменения.

Здесь лучше оставить всё как есть: локальный репозиторий и удаленный должны быть одинаковыми во избежание неприятных казусов в будущем.

### Squah, rebase и force-push коммитов

#### Squash и force-push

Часто требуется делать промежуточные коммиты, чтобы не потерять наработки или зафиксировать важную часть прогресса по задаче. При этом коммиты нужно отправить в свою ветку с изменениями в удаленном репозитории.

Отправим изменения в репозиторий (**Shift + P**). 

Теперь продолжим работу до момента, когда понадобится закончить текущую правку и объединить предыдущий коммит с последним. Как обычно, закоммитим изменения.

Далее необходимо «слить» последний коммит с предыдущим. Сделать это можно горячей клавишей **s**. Программа, запросив подтверждение, сделает squash коммита со следующим, расположенным ниже по списку.

Теперь два последних коммита объединены в один. Осталось их переименовать (по умолчанию имя общего коммита содержит описания обоих коммитов). Нажимаем **r** и удаляем лишнее (`+++`)

Отправим изменения в удаленный репозиторий. Так как локальная ветка отличается от удаленной, необходимо не просто выполнить push изменений, а сделать это в режиме **–force**, чтобы изменения перезаписались.

_Обратите внимание, что push с force нужно выполнять только тогда, когда есть четкое понимание, для чего это делается. Операция перезаписывает содержимое всей удаленной ветки, что может привести к потере данных. Например, два человека одновременно работают с одной веткой над какой-то небольшой правкой, и оба по очереди перезаписали удаленную ветку своими изменениями. Если не уследить за своевременной синхронизацией, вероятность потери данных сильно возрастает. Также нужно помнить, что ни в коем случае не следует выполнять такой push к главной ветке репозитория (master или main)._

Для отправки изменений снова нажимаем **Shift + P**. Программа определит, что удаленная ветка отличается от локальной и сама предложит сделать push с force.

#### Rebase ветки

Рассмотрим еще один частый случай. Например, во время работы текущая ветка отстала от мейнстрима, и необходимо актуализировать состояние с помощью rebase.

Для этого нужно:

- переключиться на ветку, rebase которой будем выполнять;
    
- выбрать ветку, на которую будет производиться rebase.

В случае успешного завершения процесса в дереве коммитов появятся все «новые» коммиты, соответствующие актуальному состоянию ветки `main`.

Чтобы зафиксировать изменения в удаленном репозитории, необходимо выполнить push (**Shift + P**).

### Вызов справки

В любом из окон можно вызвать справку с перечнем всех доступных горячих клавиш, нажав **x**.

### Конфигурация

Программу можно гибко настраивать под себя, начиная с цветовой гаммы и заканчивая добавлением новых команд или горячих клавиш. Все настройки лежат в файле `config.yml`, который размещается в разных каталогах в зависимости ОС:

- Linux: `~/.config/lazygit/config.yml`
    
- MacOS: `~/Library/Application Support/lazygit/config.yml`
    
- Windows: `%APPDATA%\lazygit\config.yml`

### Завершение работы

Для выхода из программы необходимо нажать горячую клавишу **q**.

## Итог

Lazygit — полезная программа, которая упрощает работу с Git. Она не занимает много места, не требует дополнительных знаний и умений помимо тех, которые требует сам Git. Программа предоставляет очень удобный интерфейс для привычных каждодневных операций, таких как управление ветками в репозитории и их rebase, squash коммитов и push ветки в удаленный репозиторий с force.

